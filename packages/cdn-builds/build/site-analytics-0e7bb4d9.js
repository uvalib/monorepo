import{i as t,_ as e,n as i,s as o,x as a}from"./property-4490ebb8.js";const r=[{name:"100 Objects",matomoSiteId:31,urls:["https://100objects.lib.virginia.edu/"]},{name:"Avalon",matomoSiteId:42,urls:["https://avalon.lib.virginia.edu/"]},{name:"Explore",matomoSiteId:2,urls:["https://explore.lib.virginia.edu/"]},{name:"Faculty Newsletter",matomoSiteId:22,inactive:!0},{name:"Library Cluster",matomoSiteId:3,urls:["https://jti.lib.virginia.edu/","https://etext.virginia.edu/"],inactive:!0},{name:"Library Web Site",matomoSiteId:10,urls:["https://www.library.virginia.edu/","https://library.virginia.edu/"]},{name:"Mobile",matomoSiteId:13,inactive:!0},{name:"Research Guides",matomoSiteId:5,urls:["https://guides.lib.virginia.edu/"]},{name:"Staff newsletter",matomoSiteId:26,inactive:!0},{name:"Tedium Reducer III",matomoSiteId:41,urls:["https://fillholdreader.internal.lib.virginia.edu/"]},{name:"Test UX",matomoSiteId:23,description:"Test Matomo Id for development/testing purposes",matomoDefault:!0},{name:"The Taper",matomoSiteId:25,urls:["https://thetaper.library.virginia.edu/"]},{name:"Virgo",matomoSiteId:1,urls:["https://search.lib.virginia.edu/"]},{name:"Virgo Lite",matomoSiteId:40,urls:["https://search-kiosk.lib.virginia.edu/"]},{name:"Modern Library Bibliography",matomoSiteId:58,urls:["https://mlbib.library.virginia.edu/"]},{name:"Board of Visitors Minutes",matomoSiteId:59,urls:["https://bov.library.virginia.edu/"]}];class s extends o{constructor(){super(...arguments),this.matomoURL="https://analytics.lib.virginia.edu/",this.spa=!1,this.variables=null}firstUpdated(){this.matomoId||(this.matomoId=this.getMatomoIdFromCurrentUrl()),this.initMatomo(),document.addEventListener("site-analytics-search",this.logSearch.bind(this)),document.addEventListener("site-analytics-event",this.logEvent.bind(this)),document.addEventListener("site-analytics-pageview",this.logPageView.bind(this))}getMatomoIdFromCurrentUrl(){const t=window.location.href,e=r.find((e=>{var i;return null===(i=e.urls)||void 0===i?void 0:i.some((e=>t.startsWith(e)))})),i=r.find((t=>!0===t.matomoDefault));return(null==e?void 0:e.matomoSiteId)||(null==i?void 0:i.matomoSiteId)}logPageView(t){var e,i,o,a,r;if(!this.matomoTracker)return;const s=(null===(e=t.detail)||void 0===e?void 0:e.customTitle)||(null===(i=document.querySelector("title"))||void 0===i?void 0:i.text)||"",m=(null===(a=null===(o=t.detail)||void 0===o?void 0:o.referrer)||void 0===a?void 0:a.startsWith("http"))?t.detail.referrer:document.location.origin+((null===(r=t.detail)||void 0===r?void 0:r.referrer)||document.referrer);this.matomoTracker.setDocumentTitle(s),this.matomoTracker.setReferrerUrl(m),this.matomoTracker.trackPageView(s)}logSearch(t){this.matomoTracker&&this.matomoTracker.trackSiteSearch(t.detail.searchQuery,t.detail.searchCategory,t.detail.resultCount.toString())}logEvent(t){t.detail&&Array.isArray(t.detail.event)&&this.matomoTracker&&this.matomoTracker.trackEvent(...t.detail.event)}initMatomo(){if(!this.matomoId)return;const t=window._paq=window._paq||[];if(this.spa||(t.push(["trackPageView"]),t.push(["enableLinkTracking"])),t.push(["setTrackerUrl",`${this.matomoURL}matomo.php`]),t.push(["setSiteId",this.matomoId.toString()]),this.variables)for(const e in this.variables)t.push(["setCustomDimension",e,this.variables[e]]);const e=document.createElement("script");e.src=`${this.matomoURL}matomo.js`,document.head.appendChild(e),this.getTracker(1e3)}getTracker(t){window.Matomo?this.matomoTracker=window.Matomo.getTracker(`${this.matomoURL}matomo.php`,this.matomoId.toString()):setTimeout((()=>this.getTracker(t+1e3)),t)}render(){return a``}}s.styles=t`
    :host {
      display: none;
    }
  `,e([i({type:String})],s.prototype,"matomoURL",void 0),e([i({type:Number})],s.prototype,"matomoId",void 0),e([i({type:Boolean})],s.prototype,"spa",void 0),e([i({type:Object})],s.prototype,"variables",void 0),window.customElements.define("site-analytics",s);
