import{_ as t,n as e}from"../../query-assigned-elements-8ef6cca7.js";import{i,s as o,x as r}from"../../lit-element-9e1ac43c.js";class a extends o{constructor(){super(...arguments),this.matomoURL="https://analytics.lib.virginia.edu/",this.spa=!1,this.variables=null}firstUpdated(){this.initMatomo(),document.addEventListener("site-analytics-search",this.logSearch.bind(this)),document.addEventListener("site-analytics-event",this.logEvent.bind(this)),document.addEventListener("site-analytics-pageview",this.logPageView.bind(this))}logPageView(t){var e,i,o,r,a;if(!this.matomoTracker)return;const s=(null===(e=t.detail)||void 0===e?void 0:e.customTitle)||(null===(i=document.querySelector("title"))||void 0===i?void 0:i.text)||"",n=(null===(r=null===(o=t.detail)||void 0===o?void 0:o.referrer)||void 0===r?void 0:r.startsWith("http"))?t.detail.referrer:document.location.origin+((null===(a=t.detail)||void 0===a?void 0:a.referrer)||document.referrer);this.matomoTracker.setDocumentTitle(s),this.matomoTracker.setReferrerUrl(n),this.matomoTracker.trackPageView(s)}logSearch(t){this.matomoTracker&&this.matomoTracker.trackSiteSearch(t.detail.searchQuery,t.detail.searchCategory,t.detail.resultCount.toString())}logEvent(t){t.detail&&Array.isArray(t.detail.event)&&this.matomoTracker&&this.matomoTracker.trackEvent(...t.detail.event)}initMatomo(){if(!this.matomoId)return;const t=window._paq=window._paq||[];if(this.spa||(t.push(["trackPageView"]),t.push(["enableLinkTracking"])),t.push(["setTrackerUrl",`${this.matomoURL}matomo.php`]),t.push(["setSiteId",this.matomoId.toString()]),this.variables)for(const e in this.variables)t.push(["setCustomDimension",e,this.variables[e]]);const e=document.createElement("script");e.src=`${this.matomoURL}matomo.js`,document.head.appendChild(e),this.getTracker(1e3)}getTracker(t){window.Matomo?this.matomoTracker=window.Matomo.getTracker(`${this.matomoURL}matomo.php`,this.matomoId.toString()):setTimeout((()=>this.getTracker(t+1e3)),t)}render(){return r``}}a.styles=i`
    :host {
      display: none;
    }
  `,t([e({type:String})],a.prototype,"matomoURL",void 0),t([e({type:Number})],a.prototype,"matomoId",void 0),t([e({type:Boolean})],a.prototype,"spa",void 0),t([e({type:Object})],a.prototype,"variables",void 0),window.customElements.define("site-analytics",a);
