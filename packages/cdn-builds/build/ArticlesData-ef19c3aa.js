import{_ as t,s as e,n as s}from"./property-4490ebb8.js";class i{constructor(t){this.items=[],this.meta={totalResults:0},this.limit=100,this.fetchRetries=3,this.fetchDelay=1e3,Object.assign(this,t)}async fetchData(){return this.items=[],Promise.resolve({items:this.items,meta:this.meta})}async fetchWithRetry(t,e={}){return this.retry((async()=>{const s=await fetch(t,e);if(!s.ok)throw new Error(s.statusText);return s}))}async retry(t,e=1){try{return await t()}catch(s){if(e<this.fetchRetries)return await new Promise((t=>setTimeout(t,this.fetchDelay))),this.retry(t,e+1);throw s}}}class a extends e{constructor(){super(...arguments),this.auto=!1}fetchResults(){if(this.url){const t=new URL(this.url);if(this.params)for(const[e,s]of Object.entries(this.params))t.searchParams.set(e,s);fetch(t.toString()).then((t=>t.json())).then((t=>{this.lastResponse=t})),this.poll&&setTimeout((()=>{this.fetchResults()}),this.poll)}}updated(t){this.auto&&(t.has("auto")||t.has("url")||t.has("params")||t.has("poll"))&&this.fetchResults(),this.lastResponse&&this.dispatchEvent(new Event("response",{bubbles:!0,composed:!0}))}}t([s({type:Boolean})],a.prototype,"auto",void 0),t([s({type:String})],a.prototype,"url",void 0),t([s({type:Object})],a.prototype,"params",void 0),t([s({type:Number,attribute:"debounce-duration"})],a.prototype,"debounceDuration",void 0),t([s({type:Number})],a.prototype,"poll",void 0),t([s({type:Object})],a.prototype,"lastResponse",void 0);class r{static async guestAuthToken(){const t=await fetch(this.authURL,{method:"POST"}).then((t=>t.text()));return void 0!==t?`Bearer ${t}`:""}static async fetchData(t,e,s,i=5){const a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8",Authorization:await r.guestAuthToken()},body:JSON.stringify({query:`keyword: {${void 0===s?"":s}}`,pagination:{start:0,rows:i},sort:{sort_id:"SortRelevance",order:"desc"},filters:[{pool_id:"uva_library",facets:[]}]})};try{const s=await fetch(t,a);if(!s.ok)throw new Error(`Error fetching data: ${s.statusText}`);const i=await s.json();return r.parseResults(e,i)}catch(t){return console.error(`Error in fetchData: ${t.message}`),{items:[],meta:{totalResults:0}}}}static parseResults(t,{group_list:e=[],pagination:s={}}){return{items:e.map((e=>{var s,i;if(1===e.count){const a=e.record_list[0],r=null===(s=a.fields.find((t=>"identifier"===t.type)))||void 0===s?void 0:s.value,o=r?`${t}/${r}`:void 0,l=a.fields.find((t=>"published_date"===t.name)),n=l?new Date(Date.UTC.apply(null,l.value.split("-"))):void 0,h=this.truncateAuthors(a.fields.filter((t=>"author"===t.type)));return{id:r,title:null===(i=a.fields.find((t=>"title"===t.type)))||void 0===i?void 0:i.value,description:"",link:o,author:h,datePublished:n,publicationType:a.fields.filter((t=>"pub_type"===t.name)).map((t=>t.value)),format:a.fields.filter((t=>"format"===t.name)).map((t=>t.value))}}return null})).filter((t=>null!==t)),meta:{totalResults:s?s.total:0}}}static truncateAuthors(t){let e=t.map((t=>t.value));if(e.length>5){const t=e.length-5;e=e.slice(0,5).concat(`and ${t} more`)}return e}}r.authURL="https://search.lib.virginia.edu/authorize";class o extends i{constructor(){super(...arguments),this.items=[]}async fetchData(t){var e;const s=null!==(e=null==t?void 0:t.limit)&&void 0!==e?e:this.limit,i=await r.fetchData(o.virgoCatalogPoolURL,o.catalogLinkBase,this.query,s+1);return i.meta.url=`https://search.lib.virginia.edu/?q=${this.query}&pool=uva_library`,this.items=i.items,this.meta=i.meta,i}}o.virgoCatalogPoolURL="https://pool-solr-ws-uva-library.internal.lib.virginia.edu/api/search",o.catalogLinkBase="https://search.lib.virginia.edu/sources/uva_library/items";class l extends i{constructor(){super(...arguments),this.items=[]}async fetchData(t){var e;const s=null!==(e=null==t?void 0:t.limit)&&void 0!==e?e:this.limit,i=await r.fetchData(l.virgoImagesPoolURL,l.catalogLinkBase,this.query,s+1);return i.meta.url=`https://search.lib.virginia.edu/?q=${this.query}&pool=uva_library`,(null==t?void 0:t.fullMeta)&&i.items.forEach((t=>{console.log(t)})),this.items=i.items,this.meta=i.meta,i}}l.virgoImagesPoolURL="https://pool-solr-ws-images.internal.lib.virginia.edu/api/search",l.catalogLinkBase="https://search.lib.virginia.edu/sources/uva_library/items";class n extends i{constructor(){super(...arguments),this.items=[]}async fetchData(t){var e;const s=null!==(e=null==t?void 0:t.limit)&&void 0!==e?e:this.limit,i=await r.fetchData(n.articlePoolURL,n.articleLinkBaseURL,this.query,s);return i.meta.url=`https://search.lib.virginia.edu/?q=keyword:+{${this.query}}&pool=articles`,this.items=i.items,this.meta=i.meta,i}}n.articlePoolURL="https://pool-eds-ws.internal.lib.virginia.edu/api/search",n.articleLinkBaseURL="https://search.lib.virginia.edu/sources/articles/items";export{n as A,o as C,a as D,i as G,l as I};
