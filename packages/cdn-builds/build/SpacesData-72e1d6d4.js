import{G as t}from"./GeneralSearchResult-331b56d5.js";import{p as e}from"./index-57095fc0.js";import{G as i}from"./ArticlesData-4e187389.js";class s extends t{constructor(t){super(t)}}function a(t){const{bookId:i,id:a,eid:n,cid:o,lid:c,fromDate:r,toDate:d,created:l,firstName:h,lastName:m,email:p,account:u,status:g,location_name:y,category_name:k,item_name:f,event:I,nickname:w,check_in_code:v,check_in_status:S,...b}=t;return new s({id:a,title:f,description:void 0,link:void 0,bookId:i,spaceId:n,categoryId:o,locationId:c,fromDate:r?e(r).getTime():void 0,toDate:d?e(d).getTime():void 0,created:l?e(l).getTime():void 0,firstName:h,lastName:m,email:p,account:u,status:g,locationName:y,categoryName:k,itemName:f,event:I,nickname:w,checkInCode:v,checkInStatus:S,formAnswers:b})}class n extends t{constructor(t){var e,i,s,a;super(t),this.locationId=null!==(e=null==t?void 0:t.locationId)&&void 0!==e?e:0,this.name=null!==(i=null==t?void 0:t.name)&&void 0!==i?i:"",this.isPublic=null!==(s=null==t?void 0:t.isPublic)&&void 0!==s&&s,this.formId=null==t?void 0:t.formId,this.adminOnly=null!==(a=null==t?void 0:t.adminOnly)&&void 0!==a&&a,this.description=null==t?void 0:t.description,this.terms=null==t?void 0:t.terms}}function o(t){return new n({id:t.lid,title:t.name,description:t.description||void 0,link:void 0,locationId:t.lid,name:t.name,isPublic:1===t.public,formId:t.formid,adminOnly:1===t.admin_only,terms:t.terms||void 0})}class c{constructor(t,e,i){this.accessTokenKey="libcal_access_token",this.tokenExpiryKey="libcal_token_expiry",this.clientId=t,this.clientSecret=e,this.baseUrl=i,this.tokenUrl=`${i}/oauth/token`}async getToken(){const t=localStorage.getItem(this.accessTokenKey),e=localStorage.getItem(this.tokenExpiryKey);return t&&e&&(new Date).getTime()<parseInt(e)?t:this.fetchNewToken()}async fetchNewToken(){const t=new URLSearchParams;t.append("client_id",this.clientId),t.append("client_secret",this.clientSecret),t.append("grant_type","client_credentials");const e=await fetch(this.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t.toString()});if(!e.ok)throw new Error(`Failed to obtain access token: ${e.statusText}`);const i=await e.json(),s=i.access_token,a=i.expires_in,n=(new Date).getTime()+1e3*a;return localStorage.setItem(this.accessTokenKey,s),localStorage.setItem(this.tokenExpiryKey,n.toString()),s}async authenticatedFetch(t,e){const i=await this.getToken();return(e=e||{}).headers=e.headers||{},e.headers.Authorization=`Bearer ${i}`,fetch(t,e)}}class r extends i{constructor(t,e){if(super(),this.days=0,this.limit=20,this.page=1,this.formAnswers=0,this.checkInStatus=0,this.includeTentative=!0,this.includeCanceled=!0,this.includeRemote=0,this.items=[],this.locations=[],Object.assign(this,t),e)this.auth=e;else{const t="1658",e="d3625b897e1c69282faa8914bbdf0d03",i="https://cal.lib.virginia.edu/api/1.1";this.auth=new c(t,e,i)}this.baseUrl=this.auth.baseUrl}endpointURL(){const t=new URLSearchParams;if(this.spaceId){const e=Array.isArray(this.spaceId)?this.spaceId.join(","):String(this.spaceId);t.append("eid",e)}if(this.categoryId&&t.append("cid",String(this.categoryId)),this.locationId&&t.append("lid",String(this.locationId)),this.email&&t.append("email",this.email),this.date)t.append("date",this.date);else{const e=(new Date).toISOString().split("T")[0];t.append("date",e)}return t.append("days",String(this.days)),`${this.baseUrl}/space/bookings?${t.toString()}`}async fetchData(){const t=this.endpointURL(),e=await this.auth.authenticatedFetch(t);if(!e.ok)throw new Error(`Failed to fetch space bookings: ${e.statusText}`);const i=await e.json();return this._parseResults(i),{items:this.items,meta:this.meta}}_parseResults(t){this.items=t.map(a),this.meta.totalResults=t.length}async fetchLocations(t){const e=new URLSearchParams;void 0!==(null==t?void 0:t.details)&&e.append("details",String(t.details)),void 0!==(null==t?void 0:t.adminOnly)&&e.append("admin_only",String(t.adminOnly));const i=`${this.baseUrl}/space/locations?${e.toString()}`,s=await this.auth.authenticatedFetch(i);if(!s.ok)throw new Error(`Failed to fetch space locations: ${s.statusText}`);const a=await s.json();return this.locations=a.map(o),this.locations}}export{r as S,n as a,s as b};
