import{a as t,b as s,y as e}from"./2ce5e5c8.js";import{B as i,o as r}from"./908d7932.js";import"./7a7ec51d.js";class l{constructor(t){this.query="",this.items=[],this.limit=5,this.meta={totalResults:0},t.query&&(this.query=t.query)}async fetchData(t){return fetch(`https://api.library.virginia.edu/libguides/srch_process_cs.php?action=580&search_source_id=0&layout=tab&start=0&group_id=0&guide_id=0&f_group_id=&f_guide_type_id=&f_guide_owner_id=&f_guide_tag_ids=&f_guide_subject_ids=&sort=_score&q=${this.query}`).then((t=>t.json())).then((s=>(this.meta.url=s.data.fulllink,this.parseResults(s.data.results),{items:this.items.slice(0,t&&t.limit?t.limit:this.limit),meta:this.meta})))}descriptionMarkupFix(t){return t}parseResults(t){const s=document.createElement("div");s.innerHTML=t;const e=s.querySelectorAll(".s-srch-result");this.items=Array.from(e).map((t=>{var s,e;return{title:null===(s=t.querySelector(".s-srch-result-title"))||void 0===s?void 0:s.innerHTML.replace(/\s\s/g," "),description:this.descriptionMarkupFix(null===(e=t.querySelectorAll(".s-srch-result-meta")[1])||void 0===e?void 0:e.innerHTML.replace(/\s\s/g," ")),link:""}})).slice(0),s.remove()}}var a;a=new WeakMap,window.customElements.define("libguides-section",class extends i{constructor(){super(),a.set(this,void 0),this.meta={totalResults:0},this.title="Subject Guides",t(this,a,new l({query:""}),"f")}updated(t){super.updated(t),t.has("query")&&(this.loading=!0,s(this,a,"f").query=this.query,s(this,a,"f").fetchData({limit:this.limit}).then((t=>{this.items=t.items,this.meta=t.meta,this.loading=!1})))}render(){var t,s;return e` <div class="bs-results--header"> <h3>${this.title}</h3> <div ?hidden="${!this.isEmptySearch}"><a href="${null===(s=null===(t=this.meta)||void 0===t?void 0:t.url)||void 0===s?void 0:s.replace(/(.*)\?.*/,"$1")}" class="uvalib-button">Search Guides</a></div> <form ?hidden="${this.isEmptySearch}" action="${this.meta.url}" method="get" style="display:inline"> ${this.meta.url&&this.meta.url.indexOf("?")>0?[...new URLSearchParams(this.meta.url.replace(/^.*\?/,""))].map((t=>e` <input type="hidden" name="${t[0]}" value="${t[1]}"> `)):""} <button type="submit" class="uvalib-button">See all results</button> </form> </div> <div class="bs-results--body"> <p id="no-results" ?hidden="${!this.isEmptySearch}">${this.noResultDescribe}</p> <p ?hidden="${this.isEmptySearch}">Subject guides contain topic-specific information to help with research and coursework.</p> <ol ?hidden="${this.isEmptySearch}" class="bs-results--list"> ${this.items.map((t=>e` <li class="bs-results--list--entry bs-results-title"><span class="bs-results--title">${r(t.title)}</span> <ul class="ul-0"> <li class="bs-results--teaser li-1">${r(t.description)}</li> </ul> </li> `))} </ol> </div> `}});
