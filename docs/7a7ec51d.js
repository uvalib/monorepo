import{_ as t,e,s,b as a}from"./2ce5e5c8.js";class i extends s{constructor(){super(...arguments),this.auto=!1}fetchResults(){if(console.log("call to fetch results!"),this.url){const t=new URL(this.url);if(this.params)for(const[e,s]of Object.entries(this.params))t.searchParams.set(e,s);fetch(t.toString()).then((t=>t.json())).then((t=>{this.lastResponse=t})),this.poll&&setTimeout((()=>{this.fetchResults()}),this.poll)}}updated(t){this.auto&&(t.has("auto")||t.has("url")||t.has("params")||t.has("poll"))&&this.fetchResults(),this.lastResponse&&this.dispatchEvent(new Event("response",{bubbles:!0,composed:!0}))}}t([e({type:Boolean})],i.prototype,"auto",void 0),t([e({type:String})],i.prototype,"url",void 0),t([e({type:Object})],i.prototype,"params",void 0),t([e({type:Number,attribute:"debounce-duration"})],i.prototype,"debounceDuration",void 0),t([e({type:Number})],i.prototype,"poll",void 0),t([e({type:Object})],i.prototype,"lastResponse",void 0);class o{static async guestAuthToken(){const t=await fetch(this.authURL,{method:"POST"}).then((t=>t.text()));return void 0!==t?`Bearer ${t}`:""}static async fetchData(t,e,s,a=5){const i={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8",Authorization:await o.guestAuthToken()},body:JSON.stringify({query:`keyword: {${s}}`,pagination:{start:0,rows:a},sort:{sort_id:"SortRelevance",order:"desc"},filters:[{pool_id:"uva_library",facets:[]}]})},n=await fetch(t,i).then((t=>t.json()));return o.parseResults(e,n)}static parseResults(t,e){const s=[],a=e.pagination&&e.pagination.total?{totalResults:e.pagination.total}:{totalResults:0};return void 0!==e.group_list&&e.group_list.forEach((e=>{if(1===e.count){const a=e.record_list[0],i=a.fields.find((t=>"identifier"===t.type)).value,o=i?`${t}/${i}`:void 0,n=a.fields.find((t=>"published_date"===t.name)),r={id:a.fields.find((t=>"identifier"===t.type)).value,title:a.fields.find((t=>"title"===t.type)).value,description:"",link:o,author:a.fields.filter((t=>"author"===t.type)).map((t=>t.value)),datePublished:n?new Date(Date.UTC.apply(null,n.value.split("-"))):void 0,publicationType:a.fields.filter((t=>"pub_type"===t.name)).map((t=>t.value)),format:a.fields.filter((t=>"format"===t.name)).map((t=>t.value))};s.push(r)}else console.log("handle grouped item")})),{items:s,meta:a}}}o.authURL="https://search.lib.virginia.edu/authorize";class n{constructor(){this.query="",this.items=[],this.limit=null}async fetchData(){return this.items=[],Promise.resolve(this.items)}}function r(t,e){if(e.length<t)throw new TypeError(t+" argument"+(t>1?"s":"")+" required, but only "+e.length+" present")}function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function c(t){r(1,arguments);var e=Object.prototype.toString.call(t);return t instanceof Date||"object"===l(t)&&"[object Date]"===e?new Date(t.getTime()):"number"==typeof t||"[object Number]"===e?new Date(t):("string"!=typeof t&&"[object String]"!==e||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}function u(t){if(r(1,arguments),"string"==typeof t){var e=t.match(/(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2})(?:\.(\d{0,7}))?(?:Z|(.)(\d{2}):?(\d{2})?)?/);return e?new Date(Date.UTC(+e[1],+e[2]-1,+e[3],+e[4]-(+e[9]||0)*("-"==e[8]?-1:1),+e[5]-(+e[10]||0)*("-"==e[8]?-1:1),+e[6],+((e[7]||"0")+"00").substring(0,3))):new Date(NaN)}return c(t)}var p,d;function h(t){return{id:t.id,title:t.title,allday:t.allday,start:t.start?u(t.start).getTime():null,end:t.end?u(t.end).getTime():null,description:t.description,link:t.url.public,location:t.location.name,campusLocation:t.campus,category:t.category.name,owner:t.owner.name,calendar:{name:t.calendar.name,url:t.calendar.public},registration:t.registration,registrationOpen:t.has_registration_opened,registrationClosed:t.has_registration_closed,seats:t.seats,seatsTaken:t.seats_taken,physicalSeats:t.physical_seats,physicalSeatsTaken:t.physical_seats_taken,onlineSeats:t.online_seats,onlineSeatsTaken:t.online_seats_taken,waitList:t.wait_list,image:t.featured_image,futureDates:t.future_dates.map((t=>({id:t.event_id,start:u(t.start).getTime()}))),registrationCost:t.registration_cost,moreInfo:t.more_info,setupTime:t.setup_time,teardownTime:t.teardown_time}}class m extends n{constructor(){super(...arguments),p.add(this),this.items=[]}async fetchData(){return fetch(a(this,p,"m",d).call(this)).then((t=>t.json())).then((t=>(this._parseResults(t),this.items)))}_parseResults(t){this.items=t.events.map(h)}}p=new WeakSet,d=function(){let t=this.query?`&search=${this.query}`:"";return t+=this.limit?`&limit=${this.limit}`:"",t+=this.category?`&category=${this.category}`:"",this.query?`https://api2.libcal.com/1.0/event_search?key=c45a1428103ed000ba4025e9970edf54&iid=863&cal_id=4299&limit=600&campus=&category=&days=365${t}`:`https://api2.libcal.com/1.0/events?key=c45a1428103ed000ba4025e9970edf54&iid=863&cal_id=4299&limit=600&campus=&category=&days=365${t}`};export{m as E,n as G,o as V,r,c as t};
