import{_ as t,e,s as i}from"./6b52cb25.js";class s extends i{constructor(){super(...arguments),this.auto=!1}fetchResults(){if(this.url){const t=new URL(this.url);if(this.params)for(const[e,i]of Object.entries(this.params))t.searchParams.set(e,i);fetch(t.toString()).then((t=>t.json())).then((t=>{this.lastResponse=t})),this.poll&&setTimeout((()=>{this.fetchResults()}),this.poll)}}updated(t){this.auto&&(t.has("auto")||t.has("url")||t.has("params")||t.has("poll"))&&this.fetchResults(),this.lastResponse&&this.dispatchEvent(new Event("response",{bubbles:!0,composed:!0}))}}t([e({type:Boolean})],s.prototype,"auto",void 0),t([e({type:String})],s.prototype,"url",void 0),t([e({type:Object})],s.prototype,"params",void 0),t([e({type:Number,attribute:"debounce-duration"})],s.prototype,"debounceDuration",void 0),t([e({type:Number})],s.prototype,"poll",void 0),t([e({type:Object})],s.prototype,"lastResponse",void 0);class a{static async guestAuthToken(){const t=await fetch(this.authURL,{method:"POST"}).then((t=>t.text()));return void 0!==t?`Bearer ${t}`:""}static async fetchData(t,e,i,s=5){const r={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8",Authorization:await a.guestAuthToken()},body:JSON.stringify({query:`keyword: {${void 0===i?"":i}}`,pagination:{start:0,rows:s},sort:{sort_id:"SortRelevance",order:"desc"},filters:[{pool_id:"uva_library",facets:[]}]})},o=await fetch(t,r).then((t=>t.json()));return a.parseResults(e,o)}static parseResults(t,e){const i=[],s=e.pagination&&e.pagination.total?{totalResults:e.pagination.total}:{totalResults:0};return void 0!==e.group_list&&e.group_list.forEach((e=>{if(1===e.count){const s=e.record_list[0],a=s.fields.find((t=>"identifier"===t.type)).value,r=a?`${t}/${a}`:void 0,o=s.fields.find((t=>"published_date"===t.name)),l={id:s.fields.find((t=>"identifier"===t.type)).value,title:s.fields.find((t=>"title"===t.type)).value,description:"",link:r,author:s.fields.filter((t=>"author"===t.type)).map((t=>t.value)),datePublished:o?new Date(Date.UTC.apply(null,o.value.split("-"))):void 0,publicationType:s.fields.filter((t=>"pub_type"===t.name)).map((t=>t.value)),format:s.fields.filter((t=>"format"===t.name)).map((t=>t.value))};i.push(l)}else console.log("handle grouped item")})),{items:i,meta:s}}}a.authURL="https://search.lib.virginia.edu/authorize";class r{constructor(t){this.items=[],this.meta={totalResults:0},Object.assign(this,t)}async fetchData(){return this.items=[],Promise.resolve({items:this.items,meta:this.meta})}}class o extends r{constructor(){super(...arguments),this.items=[]}async fetchData(t){return a.fetchData(o.virgoCatalogPoolURL,o.catalogLinkBase,this.query,t&&t.limit?t.limit:this.limit).then((t=>(t.meta.url=`https://search.lib.virginia.edu/?q=${this.query}&pool=uva_library`,this.items=t.items,this.meta=t.meta,t)))}}o.virgoCatalogPoolURL="https://pool-solr-ws-uva-library.internal.lib.virginia.edu/api/search",o.catalogLinkBase="https://search.lib.virginia.edu/sources/uva_library/items";class l extends r{constructor(){super(...arguments),this.items=[]}async fetchData(t){return a.fetchData(l.articlePoolURL,l.articleLinkBaseURL,this.query,t&&t.limit?t.limit:this.limit).then((t=>(t.meta.url=`https://search.lib.virginia.edu/?q=keyword:+{${this.query}}&pool=articles`,this.items=t.items,this.meta=t.meta,t)))}}l.articlePoolURL="https://pool-eds-ws.internal.lib.virginia.edu/api/search",l.articleLinkBaseURL="https://search.lib.virginia.edu/sources/articles/items";const n="https://library.virginia.edu/search/content";class h extends r{constructor(t){super(),this.type="",this.types=[],Object.assign(this,t)}makeQueryString(){if(this.types&&this.types.length>0){let t=this.query?`filter[fulltext]=${this.query}&`:"";return t+=this.limit?`page[limit]=${this.limit}&`:"",t+="filter[types-group][group][conjunction]=OR",this.types.forEach((e=>{t+=`&filter[${e}-filter][condition][path]=type&filter[${e}-filter][condition][value]=${e}`,t+=`&filter[${e}-filter][condition][memberOf]=types-group`})),t}return`${this.query?`filter[fulltext]=${this.query}&`:""}${this.type?`filter[type]=${this.type}&page[limit]=${this.limit}`:""}`}makeURL(){return`${h.drupalSearchEndpointURL}?${this.makeQueryString()}`}async fetchData(t){return t&&t.limit&&(this.limit=t.limit),fetch(this.makeURL()).then((t=>t.json())).then((t=>(this._parseResults(t),{items:this.items,meta:this.meta})))}_parseResults(t){this.items=t.data?t.data.map((t=>({title:t.attributes.title,description:t.attributes.body?t.attributes.body.value:null}))):[],this.meta.totalResults=t.data&&t.data.meta?t.data.meta.count:0}}h.drupalSearchEndpointURL="https://api.library.virginia.edu/drupal/jsonapi/index/default_index";export{l as A,o as C,h as D,r as G,n as W};
